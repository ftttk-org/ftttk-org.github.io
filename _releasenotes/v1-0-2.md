# Release Notes v1.0.2

**リリース日**: 2025-12-01

## 📋 概要

ビルドプロセスの改善により、Staging環境と本番環境のデプロイワークフローを完全に分離しました。これにより、誤デプロイのリスクを低減し、運用効率を向上させました。

## ✨ 新機能

### ビルド先の分離
- **`docs/` フォルダ**: Staging専用（GitHub Pages）
  - Base URL: `https://tkhugo.amana.top/`
  - CNAMEファイル: 含む
  - Gitで管理（コミット・プッシュ）
  
- **`public/` フォルダ**: Production専用（本番サーバー）
  - Base URL: `https://ftttk.org/`
  - CNAMEファイル: 含まない
  - Gitで管理しない（`.gitignore`で除外）
  - FTPで手動アップロード

### デプロイスクリプトの追加
- **`deploy-to-production.sh`**: 本番デプロイ準備スクリプト
  - 自動ビルド（`public/` に出力）
  - 自動検証（Base URL、CNAMEファイルの有無）
  - デプロイ手順の表示
  - ファイル数・サイズの確認

## 🔧 改善

### ビルドスクリプトの更新
- **`build-production.sh`**:
  - ビルド先を `docs/` から `public/` に変更
  - クリーンビルドの実装（古いファイルを自動削除）
  
- **`build-staging.sh`**:
  - `docs/` フォルダ専用として明確化
  - CNAME ファイルの自動インクルード確認

### ワークフローの改善
- **環境切り替え不要**: 各環境が独立したフォルダにビルド
- **誤デプロイ防止**: Production用ファイルをGitで管理しないことで、誤ってGitHub Pagesに反映されるリスクを排除
- **シンプルなデプロイフロー**: ビルド → FTPアップロードの2ステップのみ

## 📝 技術的な変更

### スクリプト
- `build-production.sh`: 
  - 出力先を `public/` に変更
  - `rm -rf public/*` でクリーンビルド
  
- `deploy-to-production.sh`: 
  - `public/` フォルダの検証に変更
  - CNAMEファイルの有無確認
  - Base URLの自動検証

### ドキュメント
- `BUILD.md`: 
  - 新しいビルド構成の説明を追加
  - フォルダ構成図を更新
  - デプロイフローの詳細化
  - トラブルシューティングセクションの追加

### Git設定
- `.gitignore`: 既に `public/` が除外されていることを確認

## 🎯 利点

### 運用面
- ✅ **誤デプロイ防止**: Staging用とProduction用が完全に分離
- ✅ **切り替え不要**: ビルドコマンド1つで正しい環境にビルド
- ✅ **検証の自動化**: デプロイ前にBase URLやファイル構成を自動確認
- ✅ **履歴の軽量化**: Production用ファイルをGitで管理しないため、リポジトリサイズが肥大化しない

### 開発面
- ✅ **明確な責任分離**: 各フォルダの用途が一目瞭然
- ✅ **並行作業可能**: Staging確認中も本番用ビルドが可能
- ✅ **ドキュメント充実**: BUILD.mdで全手順を明文化

## 📊 影響範囲
- 変更ファイル数: 5ファイル
  - `build-production.sh`
  - `deploy-to-production.sh`
  - `BUILD.md`
  - `docs/` フォルダ（Staging用に再ビルド）
  - `public/` フォルダ（新規作成、Production用）
  
- 既存の運用への影響: なし（ビルドプロセスの改善のみ）

## 🔄 移行について

### 既存ユーザー向け
特別な移行作業は不要です。次回のデプロイから新しいワークフローを使用してください。

### 新しいワークフロー

**Staging（GitHub Pages）へのデプロイ:**
```bash
./build-staging.sh
git add -A
git commit -m "Update content"
git push origin main
```

**Production（本番サーバー）へのデプロイ:**
```bash
./deploy-to-production.sh
# FTPで public/ の中身をアップロード
```

## 🐛 バグ修正
- 保存されていなかった記事タイトルの更新を反映
  - 例: 「成就訓練集会　証し　第一弾」→「【成就訓練集会の証し】第一弾：主の愛に押し迫られて」

---

**開発者**: AI Assistant with Josh  
**バージョン**: 1.0.2  
**前バージョン**: 1.0.1  
**リリースタイプ**: マイナーアップデート（ビルドプロセス改善）

